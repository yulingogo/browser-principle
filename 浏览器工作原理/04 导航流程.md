####导航

用户发出`url`请求到页面开始解析的过程叫做导航。

1. 浏览器进程将`url`转发给网络进程，由网络进程发送请求。
2. 网络进程接收到响应头，解析数据，然后把数据发送给浏览器进程。
3. 浏览器接收到响应头数据后，发送一个‘提交导航‘的消息给渲染进程。
4. 渲染进程收到通知后，开始准备接收`html`等数据，接收数据的方法是与网络进程建立数据管道。然后发送一个’确认提交‘的消息给浏览器进程。相当于告诉浏览器：’准备好了接收和解析数据‘
5. 浏览器进程开始清除旧文档，更新浏览器进程中的页面状态。

#### 主要阶段

##### 用户输入

+ 查询关键字。地址栏会用默认的搜索引擎，合成新的带有搜索关键字的`url`
+ `url`。符合`url`，地址栏会加上协议，合成完整的`url`

在用户输入`url`并回车时，浏览器还给了当前页面一个`beforeunload`事件，可以用来执行一些数据清理的操作，还可以询问是否要离开，如有未提交的表单。还可以取消导航。

##### `url`请求过程

首先网络进程会查找本地缓存是否缓存了该资源。

+ 有则将缓存直接将缓存发送给浏览器进程
+ 没有就进入网络请求过程
  + `dns`解析，如果时`https`协议，还需要建立`TLS`连接。
  + 利用ip地址建立`tcp`连接
  + 构建请求头，请求头中附加`cookie`等信息。
  + 发送请求头
  + 服务器接收到请求，发送响应数据，网络进程接收到响应数据，开始解析。

接收到响应数据：

+ 重定向

  状态吗是301或者302，网络进程会从响应头中的`Location`字段读取重定向地址，并重新发起新的`http`或者`https`请求。

  有些服务器会利用重定向将http请求转换为https请求。

  在导航过程中，如果服务器响应行状态码为301或者302，浏览器跳到新地址继续导航，如果是200表示浏览器可以继续处理该请求。

+ 响应数据的类型

  content-type是响应头中的一个重要字段，指明了响应体数据的类型。

##### 准备渲染进程

如果从一个页面打开了另一个新页面，并且新页面与当前页面属于同一站点（根域名与协议相同）的时候，会复用当前页面的渲染进程。其他情况会重新建立一个渲染进程。

##### 提交文档

提交文档指的是浏览器进程将网络进程收到的`html`数据提交到渲染进程。

+ 当浏览器进程收到网络进程的响应头数据后，便向渲染进程发起’提交文档‘的消息
+ 渲染进程收到消息后，与网络进程建立数据管道
+ 等文档数据数据传输完成后，渲染进程会返回’确认提交‘的消息给浏览器进程
+ 浏览器接收到消息后，更新浏览器界面状态。包括安全状态，url,前进后退的历史状态，更新web页面。

这也解释了为什么在地址栏输入了一个地址后，之前页面并没有马上消失，二十要加载一会才更新页面。

##### 渲染阶段

文档被提交之后。开始进行页面解析和子资源加载，接下来两章介绍渲染阶段。

